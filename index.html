<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr. Local</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');

:root {
    /* Brand Colors - Premium Noon-like Palette */
    --primary: #FEE600;
    --on-primary: #000000;

    --bg-color: #f0f2f5;
    --surface-color: #ffffff;

    --text-primary: #111111;
    --text-secondary: #555555;
    --text-accent: #888888;

    /* Glassmorphism - Premium Milky Glass */
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(255, 255, 255, 0.6);
    --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.04);
    --blur: 20px;

    /* Spacing & Radius */
    --radius: 24px;
    --radius-sm: 14px;
    --container-width: 100%;
    --content-width: 81%;
    --sidebar-width: 18%;
    --bg-overlay: rgba(240, 242, 245, 0.4);

    /* Advanced Classy Tokens */
    --premium-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.08);
    --glass-accent: rgba(254, 230, 0, 0.1);
}

@media (prefers-color-scheme: dark) {
    :root:not(.light) {
        --bg-color: #0F0F0F;
        --surface-color: #1a1a1a;
        --text-primary: #ffffff;
        --text-secondary: #a0a0a0;
        --text-accent: #666666;

        --glass-bg: rgba(20, 20, 20, 0.7);
        --glass-border: rgba(255, 255, 255, 0.08);
        --bg-overlay: rgba(15, 15, 15, 0.3);
    }
}

.dark {
    --bg-color: #0F0F0F;
    --surface-color: #1a1a1a;
    --text-primary: #ffffff;
    --text-secondary: #a0a0a0;
    --text-accent: #666666;

    --glass-bg: rgba(20, 20, 20, 0.7);
    --glass-border: rgba(255, 255, 255, 0.08);
    --bg-overlay: rgba(15, 15, 15, 0.3);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Outfit', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-primary);
    line-height: 1.6;
    padding-bottom: 120px;
    background-image:
        linear-gradient(var(--bg-overlay, rgba(247, 247, 247, 0.65)), var(--bg-overlay, rgba(247, 247, 247, 0.65))),
        url('public/premium-bg.jpg');
    background-size: 1400px auto;
    background-repeat: repeat;
    background-position: center top;
    background-attachment: fixed;
    transition: background 0.5s ease;
}

/* Specific background for Grocery Dark Mode */
.dark.shop-supermarket body {
    background-image:
        linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)),
        url('public/grocery-dark-bg.jpg');
    background-size: 800px auto;
    background-position: center;
    background-repeat: repeat;
}

/* Specific background for Hotel Dark Mode */
.dark.shop-hotel body {
    background-image:
        linear-gradient(rgba(0, 0, 0, 0.15), rgba(0, 0, 0, 0.15)),
        url('public/hotel-dark-bg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}

/* Specific background for Hotel Light Mode */
.light.shop-hotel body {
    background-image:
        linear-gradient(rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.4)),
        url('public/hotel-light-bg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}

/* Specific background for Textile Dark Mode */
.dark.shop-textile body {
    background-image:
        linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)),
        url('https://images.unsplash.com/photo-1534452203293-494d7ddbf7e0?q=80&w=2672&auto=format&fit=crop');
    /* Shopping/Clothes bg */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}

/* Specific background for Textile Light Mode */
.light.shop-textile body {
    background-image:
        linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6)),
        url('https://images.unsplash.com/photo-1441986300917-64674bd600d8?q=80&w=2670&auto=format&fit=crop');
    /* Light store bg */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-color);
}

::-webkit-scrollbar-thumb {
    background: #e0e0e0;
    border-radius: 10px;
    border: 3px solid var(--bg-color);
}

::-webkit-scrollbar-thumb:hover {
    background: #d0d0d0;
}

a {
    text-decoration: none;
    color: inherit;
}

/* --- UTILITIES --- */
.container {
    max-width: 100%;
    margin: 0 auto;
    padding: 0.5rem 1.5rem;
    padding-bottom: 2rem;
}

.glass {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius);
    transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.glass:hover {
    box-shadow: 0 15px 45px rgba(0, 0, 0, 0.08);
    border-color: rgba(254, 230, 0, 0.4);
}

.btn {
    background-color: var(--primary);
    color: var(--on-primary);
    font-weight: 800;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-size: 0.85rem;
    box-shadow: 0 4px 12px rgba(254, 230, 0, 0.2);
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(254, 230, 0, 0.3);
    filter: brightness(1.05);
}

.btn:active {
    transform: translateY(0) scale(0.96);
}

.btn-premium {
    background: linear-gradient(135deg, var(--primary) 0%, #ffeb3b 50%, #fdd835 100%);
    background-size: 200% auto;
    color: var(--on-primary);
    font-weight: 900;
    border: none;
    cursor: pointer;
    box-shadow: 0 10px 25px -5px rgba(254, 230, 0, 0.5);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    letter-spacing: 1px;
    text-transform: uppercase;
    animation: gradientMove 3s linear infinite;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

@keyframes gradientMove {
    0% {
        background-position: 0% 50%
    }

    50% {
        background-position: 100% 50%
    }

    100% {
        background-position: 0% 50%
    }
}

.btn-premium:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 15px 35px -5px rgba(254, 230, 0, 0.6);
}

.btn-premium::after {
    content: '';
    position: absolute;
    top: 0;
    left: -150%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
    transform: skewX(-20deg);
    pointer-events: none;
    transition: none;
}

.btn-premium:hover::after {
    left: 150%;
    transition: 0.7s ease-in-out;
}

.title-lg {
    font-size: 2rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 1rem;
}

/* --- COMPONENTS --- */

/* Header */
.app-header {
    position: sticky;
    top: 0.2rem;
    z-index: 50;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 1rem;
    padding: 0.8rem 1.5rem;
    padding-bottom: 0.8rem;
    margin: 0 1rem;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
}

.header-hidden {
    transform: translateY(-120%);
    opacity: 0;
    pointer-events: none;
}

/* Section */
.section-title {
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    color: var(--text-primary);
    letter-spacing: -0.04em;
}

.section-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(to right, var(--glass-border), transparent);
}

/* Product Card */
.grid-cols-2 {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

@media (min-width: 1024px) {
    .grid-cols-2 {
        grid-template-columns: repeat(4, 1fr);
    }
}

.product-card {
    background: rgba(255, 255, 255, 0.02);
    /* 98% Transparent */
    backdrop-filter: blur(5px);
    border-radius: var(--radius);
    padding: 0.8rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    border: 1.5px solid rgba(0, 0, 0, 0.15);
    /* Distinct Outline */
    position: relative;
    overflow: hidden;
}

.dark .product-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1.5px solid rgba(255, 255, 255, 0.2);
}

.product-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: 0.6s ease;
    pointer-events: none;
}

.product-card:hover::before {
    left: 100%;
}

.product-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.12);
    border-color: var(--primary);
}

.product-image {
    width: 100%;
    aspect-ratio: 1/1;
    border-radius: var(--radius-sm);
    overflow: hidden;
    background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, rgba(0, 0, 0, 0.02) 100%);
    box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.01);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    mix-blend-mode: multiply;
    /* Helps blend product with premium background */
    transition: transform 0.6s cubic-bezier(0.165, 0.84, 0.44, 1);
}

.product-card:hover .product-image img {
    transform: scale(1.1);
}

/* Studio Lighting Effect */
.product-image::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, transparent 50%, rgba(0, 0, 0, 0.05) 100%);
    pointer-events: none;
}

.product-title {
    font-weight: 800;
    font-size: 1.05rem;
    color: var(--text-primary);
    margin: 0;
    line-height: 1.2;
    letter-spacing: -0.02em;
}

.product-tamil {
    font-size: 0.85rem;
    color: var(--text-secondary);
    display: block;
    margin-top: 2px;
    font-weight: 400;
    opacity: 0.8;
}

.product-price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
}

.price-tag {
    font-weight: 800;
    font-size: 1.1rem;
    color: var(--text-primary);
}

.unit-tag {
    font-size: 0.75rem;
    color: var(--text-accent);
}

.add-btn {
    width: 30px !important;
    height: 30px !important;
    border-radius: 50%;
    background: var(--text-primary);
    color: var(--bg-color);
    border: none;
    font-size: 1.2rem !important;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.add-btn:hover {
    background: var(--primary);
    color: var(--on-primary);
    transform: rotate(90deg);
}

/* Sticky Cart */
.sticky-cart {
    position: fixed;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 3rem);
    max-width: 500px;
    padding: 0.8rem 1.2rem;
    z-index: 100;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 50px;
    /* Pill shape */
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    animation: floatUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes floatUp {
    from {
        transform: translate(-50%, 100%);
        opacity: 0;
    }

    to {
        transform: translate(-50%, 0);
        opacity: 1;
    }
}

@keyframes bounce {

    0%,
    100% {
        transform: translateY(0);
    }

    50% {
        transform: translateY(-10px);
    }
}

/* Modal */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(8px);
    padding: 1rem;
}

.modal-content {
    background: var(--surface-color);
    padding: 2.5rem;
    border-radius: 2rem;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes scaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }

    to {
        transform: scale(1);
        opacity: 1;
    }
}

.zone-btn {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 1.2rem;
    margin-bottom: 0.8rem;
    background: var(--bg-color);
    border: 2px solid transparent;
    border-radius: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--text-primary);
}

.zone-btn:hover {
    border-color: var(--primary);
    background: var(--surface-color);
    transform: scale(1.02);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
}


/* Inputs */
input,
select {
    width: 100%;
    padding: 0.8rem 1rem;
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    font-family: inherit;
    font-size: 1rem;
    outline: none;
    background: var(--surface-color);
    color: var(--text-primary);
    transition: all 0.3s ease;
}

input:focus,
select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(254, 230, 0, 0.15);
}

.search-input:focus {
    background: var(--surface-color);
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05), 0 0 0 4px rgba(254, 230, 0, 0.1);
}

/* Stepper & Add Button */
.card-actions {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-top: 1rem;
}

.add-cart-btn {
    width: 100%;
    padding: 0.8rem;
    background: var(--text-primary);
    color: var(--bg-color);
    border-radius: 12px;
    font-weight: 700;
    font-size: 0.9rem;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.add-cart-btn:hover {
    background: var(--primary);
    color: var(--on-primary);
    transform: scale(1.02);
}

.stepper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--bg-color);
    padding: 0.25rem;
    border-radius: 12px;
    border: 1px solid var(--glass-border);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
}

.stepper-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 30px !important;
    height: 30px !important;
    border: none;
    background: var(--surface-color);
    color: var(--text-primary);
    border-radius: 8px;
    font-size: 1.1rem !important;
    font-weight: 800;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: all 0.2s;
}

.stepper-btn:hover {
    background: var(--primary);
    color: var(--on-primary);
}

.stepper-value {
    font-weight: 800;
    font-size: 1.1rem;
    min-width: 40px;
    text-align: center;
}

.qty-unit {
    font-size: 0.75rem;
    font-weight: 400;
    color: var(--text-accent);
    margin-left: 2px;
}

/* Selected Card State */
.product-card.selected {
    border-color: var(--primary);
    background: linear-gradient(180deg, var(--surface-color) 0%, rgba(254, 230, 0, 0.03) 100%);
}

.selected-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: var(--primary);
    color: var(--on-primary);
    min-width: 24px;
    height: 24px;
    padding: 0 8px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 800;
    z-index: 2;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes popIn {
    from {
        transform: scale(0);
        opacity: 0;
    }

    to {
        transform: scale(1);
        opacity: 1;
    }
}

.suggestion-header {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 2px dashed #ddd;
}

/* --- LAYOUT --- */
.main-layout {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

@media (min-width: 1024px) {
    .main-layout {
        flex-direction: row;
        gap: 2rem;
        align-items: flex-start;
    }
}

.content-area {
    flex: 1;
    width: 100%;
    min-width: 0;
}

@media (min-width: 1024px) {
    .content-area {
        width: var(--content-width);
        max-width: var(--content-width);
        flex: 0 0 var(--content-width);
    }
}

.sidebar-cart {
    position: sticky;
    top: 7rem;
    padding: 1.5rem;
    max-height: calc(100vh - 9rem);
    display: none;
    flex-direction: column;
    border-radius: var(--radius);
    width: 100%;
}

@media (min-width: 1024px) {
    .sidebar-cart {
        display: flex;
        width: var(--sidebar-width);
        flex: 0 0 var(--sidebar-width);
    }
}

/* --- GRID SYSTEM --- */
.grid-cols-2 {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.8rem;
}

@media (min-width: 480px) {
    .grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
}

@media (min-width: 768px) {
    .grid-cols-2 {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (min-width: 1024px) {
    .grid-cols-2 {
        grid-template-columns: repeat(4, 1fr);
    }
}

/* --- PRODUCT GRID / SHELF --- */
.shelf-container {
    position: relative;
    width: 100%;
}

.product-shelf {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.6rem;
    padding: 0.5rem 0;
}

@media (min-width: 480px) {
    .product-shelf {
        gap: 1rem;
        padding: 1rem 0;
    }
}

@media (min-width: 640px) {
    .product-shelf {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (min-width: 1024px) {
    .product-shelf {
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
    }
}

@media (min-width: 1440px) {
    .product-shelf {
        grid-template-columns: repeat(5, 1fr);
    }
}

/* Fallback for horizontal scrolling if desired on mobile */
@media (max-width: 480px) {
    .product-shelf.scroll-mobile {
        display: flex;
        overflow-x: auto;
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        gap: 0.8rem;
        scrollbar-width: none;
    }

    .product-shelf.scroll-mobile::-webkit-scrollbar {
        display: none;
    }

    .product-shelf.scroll-mobile>* {
        flex: 0 0 160px;
    }
}

.shelf-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(4px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(0, 0, 0, 0.1);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    font-size: 1rem;
    color: var(--text-primary);
}

.shelf-nav-btn.left {
    left: 0;
}

.shelf-nav-btn.right {
    right: 0;
}

@media (max-width: 480px) {
    .shelf-nav-btn {
        display: flex;
    }
}


.cart-showcase-list {
    overflow-y: auto;
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.cart-item-row {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    background: var(--bg-color);
    padding: 0.5rem;
    border-radius: var(--radius-sm);
    animation: slideInRight 0.3s ease;
    font-size: 0.85rem;
}

@keyframes slideInRight {
    from {
        transform: translateX(20px);
        opacity: 0;
    }

    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.cart-item-img {
    width: 45px;
    height: 45px;
    border-radius: 6px;
    object-fit: cover;
    flex-shrink: 0;
}

.cart-item-details {
    flex: 1;
    min-width: 0;
}

.cart-item-name {
    font-weight: 600;
    font-size: 0.9rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.cart-item-price-row {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* Shop Toggle Slider */
.toggle-container {
    display: flex;
    background: var(--bg-color);
    padding: 4px;
    border-radius: 12px;
    margin-bottom: 0.5rem;
    position: relative;
    border: 1px solid var(--glass-border);
}

.toggle-slider {
    position: absolute;
    top: 4px;
    left: 4px;
    width: calc(33.333% - 4px);
    height: calc(100% - 8px);
    background: var(--primary);
    border-radius: 10px;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 1;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.toggle-container.hotel-mode .toggle-slider {
    transform: translateX(100%);
}

.toggle-container.textile-mode .toggle-slider {
    transform: translateX(200%);
}

.toggle-btn {
    flex: 1;
    padding: 0.6rem 0;
    border: none;
    background: transparent;
    color: var(--text-secondary);
    font-weight: 800;
    cursor: pointer;
    font-size: 0.95rem;
    z-index: 2;
    transition: color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.toggle-btn.active {
    color: var(--on-primary);
}

/* --- BOTTOM NAV --- */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border-top: 1px solid var(--glass-border);
    display: flex;
    justify-content: space-around;
    padding: 0.8rem 0.5rem;
    padding-bottom: max(0.8rem, env(safe-area-inset-bottom));
    z-index: 1000;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
}

@media (min-width: 1024px) {
    .bottom-nav {
        display: none;
    }
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    color: var(--text-accent);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    flex: 1;
}

.nav-item.active {
    color: var(--primary);
}

.nav-icon {
    font-size: 1.4rem;
}

/* --- SIDEBAR MENU (DRAWER) --- */
.sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.sidebar-overlay.open {
    opacity: 1;
    visibility: visible;
}

.sidebar-drawer {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 280px;
    background: var(--surface-color);
    z-index: 2001;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    padding: 2rem 1.5rem;
    box-shadow: 10px 0 30px rgba(0, 0, 0, 0.1);
}

.sidebar-overlay.open .sidebar-drawer {
    transform: translateX(0);
}

.sidebar-header {
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.menu-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.menu-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    font-weight: 800;
    color: var(--text-primary);
    transition: all 0.2s;
}

.menu-item:hover {
    background: var(--bg-color);
    transform: translateX(5px);
}

.menu-item.active {
    background: var(--primary);
    color: var(--on-primary);
}

.menu-icon {
    font-size: 1.25rem;
}

/* Menu Toggle Button */
.menu-toggle {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    border: 1px solid var(--glass-border);
    background: var(--surface-color);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    transition: all 0.3s;
}

.menu-toggle span {
    width: 20px;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all 0.3s;
}

.menu-toggle:hover {
    background: var(--bg-color);
}

/* --- CATEGORY STRIP NAV --- */
.category-wrapper {
    position: relative;
    margin: 0.5rem -1.5rem -0.5rem -1.5rem;
    display: flex;
    align-items: center;
    border-top: 1px solid var(--glass-border);
}

.category-nav {
    display: flex;
    overflow-x: auto;
    gap: 0.8rem;
    padding: 0.8rem 1.5rem;
    scrollbar-width: none;
    -ms-overflow-style: none;
    scroll-behavior: smooth;
    flex: 1;
}

.category-nav::-webkit-scrollbar {
    display: none;
}

.nav-scroll-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--surface-color);
    border: 1px solid var(--glass-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    position: absolute;
    transition: all 0.2s;
    font-size: 0.8rem;
    font-weight: bold;
}

@media (min-width: 1024px) {
    .nav-scroll-btn {
        display: flex;
    }
}

.nav-scroll-btn:hover {
    background: var(--primary);
    transform: scale(1.1);
}

.nav-scroll-btn.left {
    left: 0.5rem;
}

.nav-scroll-btn.right {
    right: 0.5rem;
}

/* --- PRODUCT SHELF NAV --- */
.shelf-container {
    position: relative;
    display: flex;
    align-items: center;
}

.shelf-nav-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--surface-color);
    border: 1px solid var(--glass-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    position: absolute;
    transition: all 0.2s;
    font-size: 1rem;
}

@media (min-width: 1024px) {
    .shelf-nav-btn {
        display: flex;
    }
}

.shelf-nav-btn:hover {
    background: var(--primary);
    transform: scale(1.1);
}

.shelf-nav-btn.left {
    left: -18px;
}

.shelf-nav-btn.right {
    right: -18px;
}

/* --- HERO SLIDER --- */
.hero-slider-wrapper {
    position: relative;
    margin: 0 -1.5rem 2rem -1.5rem;
    display: flex;
    align-items: center;
}

.hero-slider {
    position: relative;
    width: 100%;
    height: 350px;
    overflow: hidden;
    margin: 0 0 3rem 0;
    display: flex;
    align-items: center;
    background: #eee;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

@media (min-width: 768px) {
    .hero-slider {
        height: 550px;
        border-radius: var(--radius);
    }

    .hero-slider-wrapper {
        margin: 0 -1.5rem 3rem -1.5rem;
    }
}

.hero-slide {
    position: absolute;
    inset: 0;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: #f0f0f0;
    opacity: 0;
    transition: opacity 1s ease-in-out;
    display: flex;
    align-items: center;
    padding: 2.5rem;
    box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.1);
}

.hero-slide.active {
    opacity: 1;
}

.hero-content {
    max-width: 600px;
    color: white;
    animation: slideUpFade 0.8s ease-out;
}

.hero-title {
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
}

@media (min-width: 768px) {
    .hero-title {
        font-size: 3.5rem;
    }
}

.hero-subtitle {
    font-size: 1.1rem;
    opacity: 1;
    font-weight: 600;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
}

.hero-dots {
    position: absolute;
    bottom: 1.2rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.6rem;
    z-index: 5;
}

.hero-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: all 0.3s;
}

.hero-dot.active {
    background: white;
    width: 28px;
    border-radius: 4px;
}

.hero-nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s;
    font-size: 1.2rem;
}

@media (min-width: 1024px) {
    .hero-nav-btn {
        display: flex;
    }
}

.hero-nav-btn:hover {
    background: rgba(255, 255, 255, 0.4);
    transform: translateY(-50%) scale(1.1);
}

.hero-nav-btn.left {
    left: 1.5rem;
}

.hero-nav-btn.right {
    right: 1.5rem;
}

@keyframes slideUpFade {
    from {
        opacity: 0;
        transform: translateY(30px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* --- Advanced UI: Toasts & Animations --- */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
}

.toast {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(12px);
    color: white;
    padding: 12px 24px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    font-weight: 600;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 10px;
    pointer-events: auto;
    animation: toastSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.toast.success {
    border-left: 4px solid #4CAF50;
}

.toast.error {
    border-left: 4px solid #FF5252;
}

@keyframes toastSlideIn {
    from {
        opacity: 0;
        transform: translateX(100px) scale(0.9);
    }

    to {
        opacity: 1;
        transform: translateX(0) scale(1);
    }
}

.fade-in-up {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-enter {
    animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes modalPop {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(10px);
    }

    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.btn-click-effect:active {
    transform: scale(0.95);
}

.feature-card {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: center;
    padding: 1.2rem;
    min-width: 100px;
    border-radius: 20px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.9));
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.08);
    text-align: left;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    flex: 1;
    max-width: 140px;
}

.feature-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
    border-color: var(--primary);
}

.feature-icon {
    font-size: 1.4rem;
    margin-bottom: 0.6rem;
    background: var(--bg-color);
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
}

.feature-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-accent);
    font-weight: 700;
    margin-bottom: 3px;
}

.feature-value {
    font-size: 0.95rem;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1.2;
}

.badge-classy {
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    padding: 4px 10px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    color: #1a1a1a;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
    display: inline-flex;
    align-items: center;
    gap: 4px;
    letter-spacing: 0.3px;
}</style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        
const _baseProducts = [
  {
    "id": 1,
    "categoryId": "rice",
    "title": "Samba Rice",
    "titleTa": "சம்பா அரிசி",
    "price": 220,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1586201375761-83865001e31c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 2,
    "categoryId": "rice",
    "title": "Keeri Samba",
    "titleTa": "கீரி சம்பா",
    "price": 260,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 3,
    "categoryId": "rice",
    "title": "Basmati Rice",
    "titleTa": "பாஸ்மதி அரிசி",
    "price": 550,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1631201504938-1649989fe780?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 4,
    "categoryId": "veg",
    "title": "Carrot",
    "titleTa": "கேரட்",
    "price": 450,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.25,
    "image": "https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 5,
    "categoryId": "veg",
    "title": "Beans",
    "titleTa": "போஞ்சி",
    "price": 380,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.1,
    "image": "https://images.unsplash.com/photo-1567306301408-9b74779a11af?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 6,
    "categoryId": "veg",
    "title": "Potato",
    "titleTa": "உருளைக்கிழங்கு",
    "price": 280,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1518977676601-b53f82aba655?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 7,
    "categoryId": "fruit",
    "title": "Banana (Ambul)",
    "titleTa": "வாழைப்பழம் (ஆம்பல்)",
    "price": 200,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1603833665858-e61d17a86224?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 8,
    "categoryId": "fruit",
    "title": "Apple (Red)",
    "titleTa": "ஆப்பிள்",
    "price": 120,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1560806887-1e4cd0b6cbd6?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 9,
    "categoryId": "dairy",
    "title": "Highland Milk Powder",
    "titleTa": "பால் மா",
    "price": 950,
    "unit": "400g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1550583724-b2692b85b150?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 10,
    "categoryId": "dairy",
    "title": "Fresh Milk",
    "titleTa": "பசும்பால்",
    "price": 350,
    "unit": "1 L",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1528750955925-cd338578500c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 11,
    "categoryId": "oil",
    "title": "Coconut Oil",
    "titleTa": "தேங்காய் எண்ணெய்",
    "price": 650,
    "unit": "1 L",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 12,
    "categoryId": "spices",
    "title": "Chilli Powder",
    "titleTa": "மிளகாய் தூள்",
    "price": 180,
    "unit": "100g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1596040033229-a9821ebd058d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 13,
    "categoryId": "beverages",
    "title": "Coca Cola",
    "titleTa": "கோகா கோலா",
    "price": 350,
    "unit": "1.5 L",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1622483767028-3f66f32aef97?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 14,
    "categoryId": "beverages",
    "title": "Coffee Powder",
    "titleTa": "கோப்பி தூள்",
    "price": 450,
    "unit": "100g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1559056199-641a0ac8b55e?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 15,
    "categoryId": "snacks",
    "title": "Munchee Cream Cracker",
    "titleTa": "கிறீம் கிராக்கர்",
    "price": 350,
    "unit": "490g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1590080873974-9a3dc8f613d0?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 16,
    "categoryId": "snacks",
    "title": "Chocolate Biscuit",
    "titleTa": "சொக்லேட் பிஸ்கட்",
    "price": 180,
    "unit": "Small",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1558961363-fa8fdf82db35?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 17,
    "categoryId": "household",
    "title": "Sunlight Soap",
    "titleTa": "சவர்க்காரம்",
    "price": 120,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1600857544200-b2f666a9a2ec?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 18,
    "categoryId": "household",
    "title": "Vim Dishwash Bar",
    "titleTa": "விம் சவர்க்காரம்",
    "price": 140,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1583947215259-38e31be8751f?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 19,
    "categoryId": "breakfast",
    "title": "String Hoppers",
    "titleTa": "இந்தியாப்பம்",
    "price": 150,
    "unit": "10 pcs",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1610192244261-3f33de3f55e4?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 20,
    "categoryId": "breakfast",
    "title": "Parotta",
    "titleTa": "புரோட்டா",
    "price": 160,
    "unit": "2 pcs",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1599487488170-d11ec9c172f0?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 21,
    "categoryId": "lunch",
    "title": "Chicken Biryani",
    "titleTa": "சிக்கன் பிரியாணி",
    "price": 850,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1563379091339-03b21bc4a4f8?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 22,
    "categoryId": "lunch",
    "title": "Veg Lunch Packet",
    "titleTa": "சைவ சாப்பாட்டு",
    "price": 350,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 23,
    "categoryId": "dinner",
    "title": "Egg Kottu",
    "titleTa": "முட்டை கொத்து",
    "price": 650,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1627308595229-7830a5c91f9f?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 24,
    "categoryId": "short-eats",
    "title": "Fish Roll",
    "titleTa": "மீன் ரோல்",
    "price": 100,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1621841957884-1210fe19d66d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 25,
    "categoryId": "short-eats",
    "title": "Samosa (Veg)",
    "titleTa": "சமோசா",
    "price": 80,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1601050633647-81a31711cad2?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 26,
    "categoryId": "fast-food",
    "title": "Chicken Burger",
    "titleTa": "சிக்கன் பர்கர்",
    "price": 750,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 27,
    "categoryId": "rice",
    "title": "Red Rice (Sudu Kakulu)",
    "titleTa": "சிவப்பு அரிசி",
    "price": 210,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1586201375761-83865001e31c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 28,
    "categoryId": "veg",
    "title": "Onion (Big)",
    "titleTa": "பெரிய வெங்காயம்",
    "price": 350,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1618512496248-a07fe83aa8cb?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 29,
    "categoryId": "veg",
    "title": "Green Chilli",
    "titleTa": "பச்சை மிளகாய்",
    "price": 600,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.1,
    "image": "https://images.unsplash.com/photo-1588252303782-cb80119cb665?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 30,
    "categoryId": "meat",
    "title": "Fresh Chicken (Whole)",
    "titleTa": "முழு சிக்கன்",
    "price": 1150,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1587593810167-a84920ea0781?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 31,
    "categoryId": "meat",
    "title": "Tilapia Fish",
    "titleTa": "திலப்பியா மீன்",
    "price": 950,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1534604973900-c41ab4c5e638?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 32,
    "categoryId": "spices",
    "title": "Turmeric Powder",
    "titleTa": "மஞ்சள் தூள்",
    "price": 280,
    "unit": "100g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1615485290382-441e4d019cb0?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 33,
    "categoryId": "oil",
    "title": "Vegetable Oil",
    "titleTa": "தாவர எண்ணெய்",
    "price": 550,
    "unit": "1 L",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1474979266404-7eaacbadb8c5?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 34,
    "categoryId": "household",
    "title": "Surf Excel Powder",
    "titleTa": "சர்ப் எக்செல்",
    "price": 380,
    "unit": "500g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1584622781564-1d9876a13d00?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 35,
    "categoryId": "personal",
    "title": "Sunsilk Shampoo",
    "titleTa": "ஷாம்பு",
    "price": 450,
    "unit": "180ml",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1535585209827-a15fcdbc4c2d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 36,
    "categoryId": "personal",
    "title": "Lux Soap (White)",
    "titleTa": "லக்ஸ் சோப்",
    "price": 140,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1600857544200-b2f666a9a2ec?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 37,
    "categoryId": "household",
    "title": "Harpic Blue",
    "titleTa": "ஹார்பிக்",
    "price": 480,
    "unit": "500ml",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1584622781564-1d9876a13d00?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 38,
    "categoryId": "spices",
    "title": "Table Salt",
    "titleTa": "உப்பு",
    "price": 120,
    "unit": "1 kg",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1527333656061-ca7adf608ae1?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 39,
    "categoryId": "meat",
    "title": "Fresh Beef",
    "titleTa": "மாட்டு இறைச்சி",
    "price": 2400,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1588347818036-558601350947?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 40,
    "categoryId": "baby",
    "title": "Baby Cheramy Soap",
    "titleTa": "பேபி சோப்",
    "price": 180,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1544253053-add32c447528?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 41,
    "categoryId": "breakfast",
    "title": "Pol Pittu",
    "titleTa": "தேங்காய் பிட்டு",
    "price": 180,
    "unit": "1 portion",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1610192244261-3f33de3f55e4?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 42,
    "categoryId": "breakfast",
    "title": "Milk Rice (Kiribath)",
    "titleTa": "பால் சோறு",
    "price": 250,
    "unit": "1 portion",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1516684732162-798a0062be99?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 43,
    "categoryId": "lunch",
    "title": "Egg Fried Rice",
    "titleTa": "முட்டை பிரைட் ரைஸ்",
    "price": 750,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1603133872878-684f208fb84b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 44,
    "categoryId": "dinner",
    "title": "Vegetable Noodles",
    "titleTa": "வெஜிடபிள் நூடுல்ஸ்",
    "price": 600,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1552611052-33e04de081de?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 45,
    "categoryId": "short-eats",
    "title": "Chicken Cutlet",
    "titleTa": "சிக்கன் கட்லட்",
    "price": 70,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1621841957884-1210fe19d66d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 46,
    "categoryId": "fast-food",
    "title": "Cheese Sandwich",
    "titleTa": "சீஸ் சாண்ட்விச்",
    "price": 400,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1528735602780-2552fd46c7af?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 47,
    "categoryId": "beverages",
    "title": "Milo (Small Pack)",
    "titleTa": "மைலோ",
    "price": 120,
    "unit": "180ml",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1523362622747-4bc090332f14?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 48,
    "categoryId": "snacks",
    "title": "Potato Chips",
    "titleTa": "உருளைக்கிழங்கு சிப்ஸ்",
    "price": 250,
    "unit": "150g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1566478989037-eec170784d0b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 49,
    "categoryId": "veg",
    "title": "Cabbage",
    "titleTa": "கோவா",
    "price": 380,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1590779033100-9f60705a2f3b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 50,
    "categoryId": "fruit",
    "title": "Papaya",
    "titleTa": "பப்பாளி",
    "price": 280,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1526644906062-41323330e5ad?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 51,
    "categoryId": "veg",
    "title": "Leeks",
    "titleTa": "லீக்ஸ்",
    "price": 420,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.25,
    "image": "https://images.unsplash.com/photo-1563852024-9543026a7983?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 52,
    "categoryId": "veg",
    "title": "Pumpkin",
    "titleTa": "பூசணிக்காய்",
    "price": 180,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1506807803488-8eafc15531a2?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 53,
    "categoryId": "veg",
    "title": "Brinjal",
    "titleTa": "கத்தரிக்காய்",
    "price": 360,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1590779033100-9f60705a2f3b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 54,
    "categoryId": "fruit",
    "title": "Grapes (Red)",
    "titleTa": "திராட்சை",
    "price": 950,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1537640538966-79f369b41f8f?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 55,
    "categoryId": "fruit",
    "title": "Pomegranate",
    "titleTa": "மாதுளம் பழம்",
    "price": 1200,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1615485500704-8e990f9900f7?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 56,
    "categoryId": "personal",
    "title": "Lux Soap (White)",
    "titleTa": "லக்ஸ் சோப்",
    "price": 140,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1600857544200-b2f666a9a2ec?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 57,
    "categoryId": "personal",
    "title": "Toothbrush (Soft)",
    "titleTa": "பல் துலக்கி",
    "price": 150,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1559591937-e68fb3305554?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 58,
    "categoryId": "personal",
    "title": "Dettol Body Wash",
    "titleTa": "டெட்டோல்",
    "price": 850,
    "unit": "250ml",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1559056199-641a0ac8b55e?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 59,
    "categoryId": "household",
    "title": "Floor Cleaner",
    "titleTa": "தரை துப்புரவாக்கி",
    "price": 650,
    "unit": "500ml",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1584622781564-1d9876a13d00?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 60,
    "categoryId": "household",
    "title": "Facial Tissues",
    "titleTa": "திசுப் பேப்பர்",
    "price": 320,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1584622781564-1d9876a13d00?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 61,
    "categoryId": "spices",
    "title": "Garlic",
    "titleTa": "பூண்டு",
    "price": 850,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.25,
    "image": "https://images.unsplash.com/photo-1591073113125-e46713c829ed?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 62,
    "categoryId": "spices",
    "title": "Ginger",
    "titleTa": "இஞ்சி",
    "price": 1200,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.1,
    "image": "https://images.unsplash.com/photo-1582281227055-3d02cd36a60e?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 63,
    "categoryId": "fast-food",
    "title": "Veggie Pizza (Small)",
    "titleTa": "பீட்சா",
    "price": 1250,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 64,
    "categoryId": "fast-food",
    "title": "Hot Dog",
    "titleTa": "ஹாட் டாக்",
    "price": 450,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1612392062126-59911e3b567d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 65,
    "categoryId": "meat",
    "title": "Mutton (Fresh)",
    "titleTa": "ஆட்டு இறைச்சி",
    "price": 3800,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 0.5,
    "image": "https://images.unsplash.com/photo-1603048588665-791ca8aea617?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 66,
    "categoryId": "snacks",
    "title": "Mixed Bites (Mixture)",
    "titleTa": "மிக்சர்",
    "price": 320,
    "unit": "200g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1566478989037-eec170784d0b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 67,
    "categoryId": "beverages",
    "title": "Pepsi",
    "titleTa": "பெப்சி",
    "price": 350,
    "unit": "1.5 L",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1629203851020-9dd4aa08e9ca?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 68,
    "categoryId": "dairy",
    "title": "Anchor Butter",
    "titleTa": "வெண்ணெய்",
    "price": 1150,
    "unit": "200g",
    "saleType": "pc",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1589985270826-4b7bb135bc9d?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 69,
    "categoryId": "rice",
    "title": "White Rice (Kakulu)",
    "titleTa": "வெள்ளை அரிசி",
    "price": 200,
    "unit": "1 kg",
    "saleType": "kg",
    "increment": 1,
    "image": "https://images.unsplash.com/photo-1586201375761-83865001e31c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 70,
    "categoryId": "mens-wear",
    "title": "Cotton Shirt (Blue)",
    "titleTa": "ஆண்கள் சட்டை",
    "price": 1850,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "L",
    "material": "Pure Cotton",
    "image": "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 71,
    "categoryId": "mens-wear",
    "title": "Denim Jeans",
    "titleTa": "ஜீன்ஸ்",
    "price": 2400,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "32",
    "material": "Denim",
    "image": "https://images.unsplash.com/photo-1542272617-08f08630329f?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 72,
    "categoryId": "womens-wear",
    "title": "Silk Saree (Red)",
    "titleTa": "பட்டு சேலை",
    "price": 4500,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "Free Size",
    "material": "Kanchipuram Silk",
    "image": "https://images.unsplash.com/photo-1610030469983-98e550d6193c?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 73,
    "categoryId": "womens-wear",
    "title": "Cotton Kurti",
    "titleTa": "சுடிதார்",
    "price": 1250,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "M",
    "material": "Cotton Blend",
    "image": "https://images.unsplash.com/photo-1583391733956-6c78276477e2?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 74,
    "categoryId": "kids-wear",
    "title": "Kids Frock (Pink)",
    "titleTa": "குழந்தை சட்டை",
    "price": 950,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "3-4 Years",
    "material": "Cotton",
    "image": "https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 75,
    "categoryId": "kids-wear",
    "title": "Boys T-Shirt Set",
    "titleTa": "சிறுவர் சட்டை",
    "price": 850,
    "unit": "1 set",
    "saleType": "pc",
    "increment": 1,
    "size": "5-6 Years",
    "material": "Polyester",
    "image": "https://images.unsplash.com/photo-1519457431-44ccd64a579b?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 76,
    "categoryId": "accessories",
    "title": "Aviator Sunglasses",
    "titleTa": "மூக்கு கண்ணாடி",
    "price": 1500,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "Standard",
    "material": "Metal/Glass",
    "image": "https://images.unsplash.com/photo-1572635196237-14b3f281503f?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 77,
    "categoryId": "accessories",
    "title": "Leather Wallet",
    "titleTa": "பர்ஸ்",
    "price": 1200,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "Standard",
    "material": "Genuine Leather",
    "image": "https://images.unsplash.com/photo-1627123424574-724758594e93?q=80&w=400&auto=format&fit=crop"
  },
  {
    "id": 78,
    "categoryId": "mens-wear",
    "title": "Classic Polo T-Shirt",
    "titleTa": "போலோ டி-ஷர்ட்",
    "image": "https://images.unsplash.com/photo-1581655353564-df123a1eb820?q=80&w=400&auto=format&fit=crop",
    "additionalImages": [
      "https://images.unsplash.com/photo-1596755094514-f87e34085b2c?q=80&w=400&auto=format&fit=crop",
      "https://images.unsplash.com/photo-1563630423918-b58f07336ac9?q=80&w=400&auto=format&fit=crop"
    ],
    "price": 2500,
    "unit": "1 pc",
    "saleType": "pc",
    "increment": 1,
    "size": "L",
    "material": "Cotton Pique",
    "inStock": true,
    "hasVariants": true,
    "variants": {
      "S": {
        "price": 2400,
        "inStock": true
      },
      "M": {
        "price": 2500,
        "inStock": true
      },
      "L": {
        "price": 2500,
        "inStock": true
      },
      "XL": {
        "price": 2600,
        "inStock": true
      }
    },
    "description": "Premium quality Classic Polo T-Shirt made from breathable cotton pique fabric.\nPerfect for casual wear and outings.\nFeatures a ribbed collar and sleeve cuffs."
  },
  {
    "id": 79,
    "categoryId": "veg",
    "title": "Fresh Carrots (Premium)",
    "titleTa": "பிரீமியம் கேரட்",
    "image": "https://images.unsplash.com/photo-1598170845058-32b9d6a5da37?q=80&w=400&auto=format&fit=crop",
    "price": 480,
    "unit": "1 kg",
    "saleType": "pc",
    "increment": 1,
    "description": "Farm-fresh, crunchy, and sweet carrots sourced directly from Nuwara Eliya.\nRich in Vitamin A and antioxidants.\nPerfect for salads, juices, and cooking."
  },
  {
    "id": 80,
    "categoryId": "lunch",
    "title": "Special Chicken Fried Rice",
    "titleTa": "சிக்கன் ஃப்ரைட் ரைஸ் (ஸ்பெஷல்)",
    "image": "https://images.unsplash.com/photo-1603133872878-684f208fb84b?q=80&w=400&auto=format&fit=crop",
    "price": 950,
    "unit": "1 pack",
    "saleType": "pc",
    "increment": 1,
    "description": "A delicious and filling portion of Chicken Fried Rice.\nPrepared with basmati rice, tender chicken chunks, eggs, and fresh vegetables.\nServed with chili paste and sauce."
  }
];
const _baseBanners = [
  {
    "id": 1,
    "image": "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&q=80&w=1000",
    "title": "Fresh Groceries",
    "subtitle": "Delivered to your doorstep"
  },
  {
    "id": 2,
    "image": "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=1000",
    "title": "Delicious Food",
    "subtitle": "Hot from your favorite local restaurant"
  },
  {
    "id": 4,
    "title": "Gourmet Meals",
    "subtitle": "Hot and Fresh",
    "image": "public/uploads/1769630142154_close-up-appetizing-ramadan-meal.jpg"
  },
  {
    "id": 5,
    "title": "Fresh Seafood",
    "subtitle": "Caught Daily",
    "image": "public/uploads/1769630967412_top-view-fresh-fish-slices-with-red-tomatoes-kumquats-dark-background.jpg"
  },
  {
    "id": 6,
    "title": "Premium Meats",
    "subtitle": "Prime Cuts for You",
    "image": "public/uploads/1769630977785_overhead-view-red-meat-wooden-tray-garlic-green-lemon-pepper-onion-fork-knife-notebook-dark-background.jpg"
  },
  {
    "id": 7,
    "title": "Organic Harvest",
    "subtitle": "Direct from Farms",
    "image": "public/uploads/1769630998353_organic-tomato-with-water-droplets-closeup-macro.jpg"
  },
  {
    "id": 8,
    "title": "Trendy Fashion",
    "subtitle": "New Collection Arrived",
    "image": "https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1000&auto=format&fit=crop"
  },
  {
    "id": 9,
    "title": "Kids Special",
    "subtitle": "Cute Outfits for Little Ones",
    "image": "https://images.unsplash.com/photo-1622290291468-a28f7a7dc6a8?q=80&w=1000&auto=format&fit=crop"
  }
];
const _baseSettings = {
  "phoneNumber": "+94763885530",
  "adminPin": "Irhaas007@"
};

// Sync with LocalStorage from Admin
const localProducts = JSON.parse(localStorage.getItem('mr-local-products')) || _baseProducts;
const localBanners = JSON.parse(localStorage.getItem('mr-local-banners')) || _baseBanners;
const localSettings = JSON.parse(localStorage.getItem('mr-local-settings')) || _baseSettings;

        const { useState, useEffect, useRef, useMemo, useCallback } = React;


// --- DATA ---
const categories = [
  // Supermarket
  { id: 'rice', name: 'Rice & Flour', nameTa: 'அரிசி / மாவு' },
  { id: 'veg', name: 'Vegetables', nameTa: 'காய்கறிகள்' },
  { id: 'fruit', name: 'Fruits', nameTa: 'பழங்கள்' },
  { id: 'meat', name: 'Meat & Fish', nameTa: 'இறைச்சி / மீன்' },
  { id: 'dairy', name: 'Dairy & Chilled', nameTa: 'பால் பொருட்கள்' },
  { id: 'beverages', name: 'Beverages', nameTa: 'குளிர்பானங்கள்' },
  { id: 'snacks', name: 'Snacks', nameTa: 'சிற்றுண்டி' },
  { id: 'spices', name: 'Spices', nameTa: 'மளிகை' },
  { id: 'oil', name: 'Oil & Coconut', nameTa: 'எண்ணெய்' },
  { id: 'household', name: 'Household', nameTa: 'வீட்டு தேவைகள்' },
  { id: 'personal', name: 'Personal Care', nameTa: 'சுய பராமரிப்பு' },
  { id: 'baby', name: 'Baby Care', nameTa: 'குழந்தை பராமரிப்பு' },
  // Hotel / Restaurant
  { id: 'breakfast', name: 'Breakfast', nameTa: 'காலை உணவு' },
  { id: 'lunch', name: 'Lunch', nameTa: 'மதிய உணவு' },
  { id: 'dinner', name: 'Dinner', nameTa: 'இரவு உணவு' },
  { id: 'short-eats', name: 'Short Eats', nameTa: 'சிற்றுண்டி' },
  { id: 'fast-food', name: 'Fast Food', nameTa: 'துரித உணவு' },
  // Textile / Clothing
  { id: 'mens-wear', name: "Men's Wear", nameTa: 'ஆண்கள் ஆடை' },
  { id: 'womens-wear', name: "Women's Wear", nameTa: 'பெண்கள் ஆடை' },
  { id: 'kids-wear', name: "Kids' Wear", nameTa: 'சிறுவர் ஆடை' },
  { id: 'accessories', name: 'Accessories', nameTa: 'பொருட்கள்' },
];




// --- UTILITIES ---
const DELIVERY_ZONES = {
  A: { id: 'A', name: 'Zone A (Sainthamaruthu)', fee: 50 },
  B: { id: 'B', name: 'Zone B (Kalmunai Town)', fee: 150 },
  C: { id: 'C', name: 'Zone C (Nintavur/Karaitivu)', fee: 250 },
};

function calculateTotal(cart, zoneId, customFees, shopType) {
  const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const type = shopType || 'supermarket';
  const feesForShop = customFees?.[type] || { A: 50, B: 150, C: 250 };
  const delivery = feesForShop[zoneId] || 0;
  return {
    subtotal: Math.round(subtotal),
    delivery,
    total: Math.round(subtotal + delivery)
  };
}

function formatQuantity(qty, saleType) {
  return `${qty} pc`;
}

function createWhatsAppLink(phoneNumber, cart, zoneId, customFees, shopType) {
  const zone = DELIVERY_ZONES[zoneId];
  const { subtotal, delivery, total } = calculateTotal(cart, zoneId, customFees, shopType);

  let message = `*New Order!* 🛍️\n`;
  message += `📍 *Location*: ${zone?.name || 'Unknown'}\n\n`;
  message += `*Items:*\n`;

  cart.forEach(item => {
    const qtyStr = formatQuantity(item.quantity, item.saleType);
    message += `▪️ ${qtyStr} x ${item.title}: Rs. ${Math.round(item.price * item.quantity)}\n`;
  });

  message += `\n-------------------\n`;
  message += `📝 *Subtotal*: Rs. ${subtotal}\n`;
  message += `🚚 *Delivery*: Rs. ${delivery}\n`;
  message += `💰 *TOTAL TO PAY*: *Rs. ${total}*\n`;
  message += `-------------------\n\n`;
  message += `⚠️ Please share your *Live Location* to confirm delivery! 📍`;

  const encodedMessage = encodeURIComponent(message);
  return `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
}

function HeroSlider({ banners }) {
  const [active, setActive] = useState(0);

  useEffect(() => {
    if (!banners || banners.length <= 1) return;
    const timer = setInterval(() => {
      setActive((prev) => (prev + 1) % banners.length);
    }, 6000);
    return () => clearInterval(timer);
  }, [banners]);

  const move = (direction) => {
    if (!banners || banners.length === 0) return;
    if (direction === 'next') {
      setActive((prev) => (prev + 1) % banners.length);
    } else {
      setActive((prev) => (prev - 1 + banners.length) % banners.length);
    }
  };

  if (!banners || banners.length === 0) return null;

  return (
    <div className="hero-slider-wrapper">
      <button className="hero-nav-btn left" onClick={() => move('prev')}>❮</button>
      <div className="hero-slider">
        {banners.map((banner, index) => (
          <div
            key={banner.id}
            className={`hero-slide ${active === index ? 'active' : ''}`}
            style={{ backgroundImage: `linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.1)), url(${banner.image})` }}
          >
            <div className="hero-content">
              <h2 className="hero-title">{banner.title}</h2>
              <p className="hero-subtitle">{banner.subtitle}</p>
            </div>
          </div>
        ))}
        <div className="hero-dots">
          {banners.map((_, index) => (
            <div
              key={index}
              className={`hero-dot ${active === index ? 'active' : ''}`}
              onClick={() => setActive(index)}
            ></div>
          ))}
        </div>
      </div>
      <button className="hero-nav-btn right" onClick={() => move('next')}>❯</button>
    </div>
  );
}

// --- COMPONENTS ---

function LocationGate({ onSelect }) {
  return (
    <div className="modal-overlay">
      <div className="modal-content glass" style={{ textAlign: 'center' }}>
        <div style={{ fontSize: '3.5rem', marginBottom: '1rem', animation: 'bounce 2s infinite' }}>📍</div>
        <h2 className="title-lg" style={{ fontSize: '1.8rem', marginBottom: '0.5rem', letterSpacing: '-0.03em' }}>Welcome to Mr. Local</h2>
        <p style={{ color: 'var(--text-secondary)', marginBottom: '2.5rem', fontSize: '1rem' }}>
          Please select your delivery area to continue
        </p>
        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.8rem', textAlign: 'left' }}>
          {Object.values(DELIVERY_ZONES).map((zone) => (
            <button key={zone.id} onClick={() => onSelect(zone.id)} className="zone-btn">
              <div style={{ display: 'flex', flexDirection: 'column' }}>
                <span style={{ fontSize: '1.05rem', fontWeight: 800 }}>{zone.name.split(' (')[0]}</span>
                <span style={{ fontSize: '0.8rem', color: 'var(--text-accent)', fontWeight: 400 }}>{zone.name.match(/\((.*?)\)/)?.[1]}</span>
              </div>
              <div style={{ fontWeight: 800, color: zone.fee === 0 ? '#4caf50' : 'var(--text-primary)' }}>
                {zone.fee === 0 ? 'FREE' : `Rs. ${zone.fee}`}
              </div>
            </button>
          ))}
        </div>
        <p style={{ marginTop: '2rem', fontSize: '0.75rem', color: 'var(--text-accent)' }}>
          We currently only deliver to these selected areas.
        </p>
      </div>
    </div>
  );
}

function ProductCard({ product, cartItem, onAdd, onRemove, onSelect, wishlist, toggleWishlist }) {
  const quantity = cartItem ? cartItem.quantity : 0;
  const isOutOfStock = product.inStock === false;

  const isWishlisted = wishlist && wishlist.includes(product.id);

  return (
    <div
      className={`product-card fade-in-up ${quantity > 0 ? 'selected' : ''}`}
      onClick={() => onSelect && onSelect(product)}
      style={{ cursor: 'pointer', opacity: isOutOfStock ? 0.7 : 1, position: 'relative' }}
    >
      <button
        onClick={(e) => { e.stopPropagation(); toggleWishlist && toggleWishlist(product.id); }}
        style={{
          position: 'absolute',
          top: '10px',
          right: '10px',
          zIndex: 20,
          background: 'rgba(255,255,255,0.9)',
          border: 'none',
          borderRadius: '50%',
          width: '32px',
          height: '32px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          fontSize: '1.2rem',
          color: isWishlisted ? '#ff5252' : '#ccc',
          boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          transition: 'transform 0.2s'
        }}
        onMouseDown={e => e.target.style.transform = 'scale(0.9)'}
        onMouseUp={e => e.target.style.transform = 'scale(1)'}
      >
        {isWishlisted ? '♥' : '♡'}
      </button>

      {quantity > 0 && (
        <div className="selected-badge" style={{ right: 'auto', left: '10px' }}>
          {quantity}
        </div>
      )}

      {isOutOfStock && (
        <div style={{
          position: 'absolute', inset: 0, background: 'rgba(0,0,0,0.4)', backdropFilter: 'grayscale(1)',
          display: 'flex', alignItems: 'center', justifyContent: 'center',
          color: 'white', fontWeight: 800, fontSize: '1.2rem', zIndex: 10, borderRadius: '16px',
          textShadow: '0 2px 4px rgba(0,0,0,0.5)'
        }}>
          SOLD OUT
        </div>
      )}
      {quantity > 0 && <div className="selected-badge">{formatQuantity(quantity, product.saleType)}</div>}
      <div className="product-image">
        <img src={product.image || 'https://placehold.co/400x400/png?text=No+Image'} alt={product.title} loading="lazy" />
      </div>
      <div className="product-info" style={{ padding: '0 0.5rem 0.5rem 0.5rem' }}>
        <h3 className="product-title">{product.title}</h3>
        <span className="product-tamil">{product.titleTa}</span>
        {(product.size || product.material) && (
          <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap', fontSize: '0.75rem', color: 'var(--text-accent)', margin: '0.4rem 0', borderTop: '1px solid var(--glass-border)', paddingTop: '0.4rem' }}>
            {product.size && <span className="badge-classy">📏 {product.size}</span>}
            {product.material && <span className="badge-classy">🧵 {product.material}</span>}
          </div>
        )}

        <div className="product-price-row">
          <div className="price-tag">
            Rs. {product.price}
            <span className="unit-tag"> / {product.unit}</span>
          </div>

          <div className="card-actions">
            {quantity === 0 ? (
              <button
                className="add-btn"
                onClick={(e) => { e.stopPropagation(); if (isOutOfStock) return; onAdd(product); }}
                title={isOutOfStock ? "Out of Stock" : "Add to cart"}
                disabled={isOutOfStock}
                style={isOutOfStock ? { background: '#ccc', cursor: 'not-allowed', color: '#666' } : {}}
              >
                {isOutOfStock ? '✕' : '+'}
              </button>
            ) : (
              <div className="stepper" onClick={(e) => e.stopPropagation()} style={{ transform: 'scale(0.9)', transformOrigin: 'right' }}>
                <button className="stepper-btn" onClick={(e) => { e.stopPropagation(); onRemove(product); }}>-</button>
                <span className="stepper-value" style={{ fontSize: '0.9rem' }}>
                  {formatQuantity(quantity, product.saleType)}
                </span>
                <button className="stepper-btn" onClick={(e) => { e.stopPropagation(); onAdd(product); }}>+</button>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}
function ProductShelf({ products, cart, onAdd, onRemove, onSelect, wishlist, toggleWishlist }) {
  const shelfRef = useRef(null);

  const scroll = (direction) => {
    if (shelfRef.current) {
      const { scrollLeft } = shelfRef.current;
      const scrollTo = direction === 'left' ? scrollLeft - 300 : scrollLeft + 300;
      shelfRef.current.scrollTo({ left: scrollTo, behavior: 'smooth' });
    }
  };

  return (
    <div className="shelf-container">
      <button className="shelf-nav-btn left" onClick={() => scroll('left')}>❮</button>
      <div className="product-shelf scroll-mobile" ref={shelfRef}>
        {products.map((product) => (
          <ProductCard
            key={product.id}
            product={product}
            cartItem={cart.find(c => c.id === product.id)}
            wishlist={wishlist}
            toggleWishlist={toggleWishlist}
            onAdd={onAdd}
            onRemove={onRemove}
            onSelect={onSelect}
          />
        ))}
      </div>
      <button className="shelf-nav-btn right" onClick={() => scroll('right')}>❯</button>
    </div>
  );
}


function CategoryNav({ activeId, onSelect, shopType }) {
  const navRef = useRef(null);
  const filteredCategories = categories.filter(cat => {
    if (shopType === 'hotel') return ['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food'].includes(cat.id);
    if (shopType === 'textile') return ['mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(cat.id);
    return !['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food', 'mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(cat.id);
  });

  const scroll = (direction) => {
    if (navRef.current) {
      const { scrollLeft, clientWidth } = navRef.current;
      const scrollTo = direction === 'left' ? scrollLeft - 200 : scrollLeft + 200;
      navRef.current.scrollTo({ left: scrollTo, behavior: 'smooth' });
    }
  };

  return (
    <div className="category-wrapper">
      <button className="nav-scroll-btn left" onClick={() => scroll('left')}>❮</button>
      <div className="category-nav" ref={navRef}>
        {filteredCategories.map(cat => (
          <button
            key={cat.id}
            onClick={() => {
              onSelect(cat.id);
              const el = document.getElementById(`cat-${cat.id}`);
              if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'center' });
            }}
            style={{
              whiteSpace: 'nowrap',
              padding: '0.7rem 1.4rem',
              borderRadius: '14px',
              border: 'none',
              background: activeId === cat.id ? 'var(--primary)' : 'var(--surface-color)',
              color: activeId === cat.id ? 'var(--on-primary)' : 'var(--text-secondary)',
              fontWeight: 800,
              fontSize: '0.9rem',
              cursor: 'pointer',
              boxShadow: activeId === cat.id
                ? '0 8px 16px rgba(254, 230, 0, 0.4)'
                : '0 4px 12px rgba(0,0,0,0.04)',
              transition: 'all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
              flexShrink: 0,
              transform: activeId === cat.id ? 'scale(1.05)' : 'scale(1)'
            }}
          >
            {cat.name}
          </button>
        ))}
      </div>
      <button className="nav-scroll-btn right" onClick={() => scroll('right')}>❯</button>
    </div>
  );
}

function SidebarCart({ cart, onAdd, onRemove, zoneId, phoneNumber, deliveryFees, shopType }) {
  if (cart.length === 0) {
    return (
      <div className="sidebar-cart glass" style={{ padding: '1rem', marginTop: '9.5rem' }}>
        <h2 className="section-title" style={{ fontSize: '1rem', marginBottom: '0.8rem' }}>Cart Summary 🛍️</h2>
        <div style={{ textAlign: 'center', padding: '2rem', color: 'var(--text-accent)' }}>
          <div style={{ fontSize: '2rem', marginBottom: '1rem' }}>🛒</div>
          <p>Your cart is empty</p>
        </div>
      </div>
    );
  }

  const handleCheckout = () => {
    const link = createWhatsAppLink(phoneNumber, cart, zoneId, deliveryFees, shopType);
    window.open(link, '_blank');
  };

  const { subtotal, delivery, total } = calculateTotal(cart, zoneId, deliveryFees, shopType);

  return (
    <div className="sidebar-cart glass" style={{ padding: '1.2rem', marginTop: '9.5rem' }}>
      <h2 className="section-title" style={{ fontSize: '1.1rem', marginBottom: '1rem', justifyContent: 'center' }}>Cart Summary 🛍️</h2>
      <div className="cart-showcase-list" style={{ gap: '0.8rem', flex: 1, padding: '0.4rem' }}>
        {cart.map((item) => (
          <div key={item.id} className="cart-item-row" style={{ padding: '0.6rem', borderRadius: '12px', background: 'var(--surface-color)', border: '1px solid var(--glass-border)', boxShadow: '0 2px 8px rgba(0,0,0,0.02)' }}>
            <img src={item.image || 'https://placehold.co/400x400/png?text=No+Image'} className="cart-item-img" alt={item.title} style={{ width: '50px', height: '50px', borderRadius: '10px' }} />
            <div className="cart-item-details">
              <div className="cart-item-name" style={{ fontSize: '0.9rem', fontWeight: 700 }}>{item.title}</div>
              <div style={{ fontSize: '0.75rem', color: 'var(--text-accent)', marginBottom: '4px' }}>
                Rs.{item.price} / {item.unit}
              </div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                <button onClick={() => onRemove(item)} style={{ width: '22px', height: '22px', borderRadius: '6px', border: 'none', background: 'var(--bg-color)', cursor: 'pointer', fontSize: '0.8rem', fontWeight: 800, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>-</button>
                <span style={{ fontWeight: '800', fontSize: '0.8rem', minWidth: '30px', textAlign: 'center' }}>{formatQuantity(item.quantity, item.saleType)}</span>
                <button onClick={() => onAdd(item)} style={{ width: '22px', height: '22px', borderRadius: '6px', border: 'none', background: 'var(--bg-color)', cursor: 'pointer', fontSize: '0.8rem', fontWeight: 800, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>+</button>
              </div>
            </div>
            <div style={{ fontWeight: '800', fontSize: '0.9rem', color: 'var(--text-primary)' }}>
              Rs.{Math.round(item.price * item.quantity)}
            </div>
          </div>
        ))}
      </div>
      <div style={{ marginTop: '1rem', paddingTop: '0.8rem', borderTop: '1px solid var(--glass-border)' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem', fontSize: '0.9rem' }}>
          <span style={{ color: 'var(--text-secondary)' }}>Subtotal</span>
          <span style={{ fontWeight: 600 }}>Rs. {subtotal}</span>
        </div>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.8rem', fontSize: '0.9rem' }}>
          <span style={{ color: 'var(--text-secondary)' }}>Delivery Fee</span>
          <span style={{ color: delivery === 0 ? '#4caf50' : 'inherit', fontWeight: 600 }}>
            {delivery === 0 ? 'Free' : `Rs. ${delivery}`}
          </span>
        </div>
        <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '1.2rem', padding: '0.8rem 0', borderTop: '1px dashed var(--glass-border)', fontSize: '1.1rem' }}>
          <span style={{ fontWeight: 600 }}>Total</span>
          <span style={{ fontWeight: '800', color: 'var(--text-primary)' }}>Rs. {total}</span>
        </div>
        <button onClick={handleCheckout} className="btn-premium" style={{ width: '100%', padding: '1rem', borderRadius: '16px', fontSize: '0.9rem' }}>
          Finalize Order 💬
        </button>
      </div>
    </div>
  );
}

function StickyCart({ cart, zoneId, phoneNumber, deliveryFees, shopType }) {
  if (cart.length === 0) return null;

  const { total } = calculateTotal(cart, zoneId, deliveryFees, shopType);
  const itemCount = cart.reduce((sum, item) => sum + (item.saleType === 'unit' ? item.quantity : 1), 0);

  const handleCheckout = () => {
    const link = createWhatsAppLink(phoneNumber, cart, zoneId, deliveryFees, shopType);
    window.open(link, '_blank');
  };

  return (
    <div className="sticky-cart glass" style={{ border: '2px solid var(--primary)' }}>
      <div style={{ display: 'flex', flexDirection: 'column' }}>
        <span style={{ fontSize: '0.75rem', fontWeight: 600, color: 'var(--text-accent)', textTransform: 'uppercase' }}>{itemCount} {itemCount === 1 ? 'Item' : 'Items'}</span>
        <span style={{ fontSize: '1.25rem', fontWeight: '800', color: 'var(--text-primary)' }}>Rs. {total}</span>
      </div>
      <button onClick={handleCheckout} className="btn-premium" style={{ padding: '0.9rem 1.8rem', borderRadius: '50px' }}>
        Order Now <span style={{ marginLeft: '8px' }}>💬</span>
      </button>
    </div>
  );
}


function SidebarMenu({ isOpen, onClose, shopType, setShopType }) {
  return (
    <div className={`sidebar-overlay ${isOpen ? 'open' : ''}`} onClick={onClose}>
      <div className="sidebar-drawer" onClick={(e) => e.stopPropagation()}>
        <div className="sidebar-header">
          <div style={{ display: 'flex', alignItems: 'center', gap: '0.8rem' }}>
            <div style={{ width: '40px', height: '40px', background: 'var(--primary)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.4rem', boxShadow: '0 4px 12px rgba(254, 230, 0, 0.4)' }}>🛵</div>
            <h2 style={{ fontSize: '1.4rem', fontWeight: 800, color: 'var(--text-primary)', letterSpacing: '-0.04em' }}>Mr. Local</h2>
          </div>
          <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '1.5rem', cursor: 'pointer' }}>✕</button>
        </div>

        <nav className="menu-list">
          <button
            className={`menu-item ${shopType === 'supermarket' ? 'active' : ''}`}
            onClick={() => { setShopType('supermarket'); onClose(); }}
          >
            <span className="menu-icon">🥬</span> Fresh Groceries
          </button>
          <button
            className={`menu-item ${shopType === 'hotel' ? 'active' : ''}`}
            onClick={() => { setShopType('hotel'); onClose(); }}
          >
            <span className="menu-icon">🍽️</span> Hot Restaurant
          </button>
          <button
            className={`menu-item ${shopType === 'textile' ? 'active' : ''}`}
            onClick={() => { setShopType('textile'); onClose(); }}
          >
            <span className="menu-icon">👕</span> Textile & Fashion
          </button>
          <div style={{ height: '1px', background: 'var(--glass-border)', margin: '1rem 0' }}></div>
          <button className="menu-item" onClick={() => { window.location.href = '/admin'; onClose(); }}>
            <span className="menu-icon">⚙️</span> Admin Panel
          </button>
          <button className="menu-item" onClick={onClose}>
            <span className="menu-icon">📍</span> Change Zone
          </button>
        </nav>

        <div style={{ marginTop: 'auto', textAlign: 'center' }}>
          <p style={{ fontSize: '0.8rem', color: 'var(--text-accent)' }}>© 2026 Mr. Local Delivery</p>
        </div>
      </div>
    </div>
  );
}

function BottomNav({ activeShop, onShopSelect }) {
  return (
    <nav className="bottom-nav">
      <div
        className={`nav-item ${activeShop === 'supermarket' ? 'active' : ''}`}
        onClick={() => onShopSelect('supermarket')}
      >
        <span className="nav-icon">🛒</span>
        <span>Shop</span>
      </div>
      <div
        className={`nav-item ${activeShop === 'hotel' ? 'active' : ''}`}
        onClick={() => onShopSelect('hotel')}
      >
        <span className="nav-icon">🍲</span>
        <span>Eats</span>
      </div>
      <div
        className={`nav-item ${activeShop === 'textile' ? 'active' : ''}`}
        onClick={() => onShopSelect('textile')}
      >
        <span className="nav-icon">👕</span>
        <span>Style</span>
      </div>
      <div
        className="nav-item"
        onClick={() => {
          const cartEl = document.querySelector('.sticky-cart');
          if (cartEl) cartEl.scrollIntoView({ behavior: 'smooth' });
        }}
      >
        <span className="nav-icon">🛍️</span>
        <span>Cart</span>
      </div>
    </nav>
  );
}

// --- MAIN PAGE ---

// Import local data directly




function ToastContainer({ toasts, removeToast }) {
  return (
    <div className="toast-container">
      {toasts.map(toast => (
        <div key={toast.id} className={`toast ${toast.type}`} onClick={() => removeToast(toast.id)}>
          {toast.type === 'success' ? '✅' : 'ℹ️'} {toast.message}
        </div>
      ))}
    </div>
  );
}

function ProductDetailsModal({ product, onClose, cart, onAdd, onRemove }) {
  const [activeImage, setActiveImage] = useState(product.image);
  const [selectedSize, setSelectedSize] = useState(null);

  useEffect(() => { setActiveImage(product.image); }, [product]);

  useEffect(() => {
    if (product.hasVariants && product.variants) {
      const firstSize = Object.keys(product.variants).find(s => product.variants[s].inStock) || Object.keys(product.variants)[0];
      setSelectedSize(firstSize);
    } else {
      setSelectedSize(null);
    }
  }, [product]);

  const images = [product.image, ...(product.additionalImages || [])].filter(Boolean);

  let currentPrice = product.price;
  let isOutOfStock = product.inStock === false;
  let currentId = product.id;
  let currentTitle = product.title;

  if (product.hasVariants && selectedSize && product.variants[selectedSize]) {
    currentPrice = product.variants[selectedSize].price || product.price;
    isOutOfStock = product.variants[selectedSize].inStock === false;
    currentId = `${product.id}-${selectedSize}`;
    currentTitle = `${product.title} (${selectedSize})`;
  }

  const cartItem = cart.find(c => c.id == currentId);
  const quantity = cartItem ? cartItem.quantity : 0;

  const handleAdd = () => {
    onAdd({
      ...product,
      id: currentId,
      title: currentTitle,
      price: currentPrice,
      variant: selectedSize,
      saleType: 'pc'
    });
  };

  const handleRemove = () => {
    onRemove({ ...product, id: currentId });
  };

  return (
    <div style={{ position: 'fixed', inset: 0, zIndex: 3000, background: 'rgba(0,0,0,0.85)', backdropFilter: 'blur(10px)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '1rem' }} onClick={onClose}>
      <div className="modal-enter" style={{ background: 'var(--bg-color)', width: '100%', maxWidth: '900px', maxHeight: '90vh', overflowY: 'auto', borderRadius: '24px', position: 'relative', display: 'flex', flexDirection: 'column', gap: '0' }} onClick={e => e.stopPropagation()}>

        <button onClick={onClose} style={{ position: 'absolute', top: '1rem', right: '1rem', width: '40px', height: '40px', borderRadius: '50%', background: 'rgba(0,0,0,0.5)', color: 'white', border: 'none', cursor: 'pointer', zIndex: 10, fontSize: '1.2rem' }}>✕</button>

        <div style={{ display: 'grid', gridTemplateColumns: 'minmax(300px, 1.2fr) 1fr', gap: '0' }} className="modal-grid">
          <div className="modal-image-area" style={{ minHeight: '400px', background: '#000', position: 'relative', display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column' }}>
            <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', width: '100%', padding: '1rem' }}>
              <img src={activeImage} style={{ maxWidth: '100%', maxHeight: '400px', objectFit: 'contain' }} />
            </div>
            {images.length > 1 && (
              <div style={{ display: 'flex', justifyContent: 'center', gap: '0.5rem', padding: '1rem', overflowX: 'auto', width: '100%', background: 'rgba(0,0,0,0.3)' }}>
                {images.map((img, i) => (
                  <img key={i} src={img} onClick={() => setActiveImage(img)} style={{ width: '60px', height: '60px', objectFit: 'cover', borderRadius: '8px', border: activeImage === img ? '2px solid white' : '2px solid transparent', cursor: 'pointer', background: 'rgba(0,0,0,0.5)' }} />
                ))}
              </div>
            )}
          </div>

          <div className="modal-content-area" style={{ padding: '2rem' }}>
            <h2 className="product-title-modal" style={{ fontSize: '2rem', marginBottom: '0.2rem', lineHeight: 1.2 }}>{product.title}</h2>
            <h3 style={{ fontSize: '1.4rem', color: 'var(--text-accent)', marginBottom: '1.5rem', fontFamily: 'inherit' }}>{product.titleTa}</h3>

            <div style={{ display: 'flex', gap: '1rem', marginBottom: '2rem', flexWrap: 'wrap' }}>
              {product.size && !product.hasVariants && (
                <div className="feature-card">
                  <div className="feature-icon">📏</div>
                  <div className="feature-label">Size</div>
                  <div className="feature-value">{product.size}</div>
                </div>
              )}
              {product.material && (
                <div className="feature-card">
                  <div className="feature-icon">🧵</div>
                  <div className="feature-label">Material</div>
                  <div className="feature-value">{product.material}</div>
                </div>
              )}
              <div className="feature-card">
                <div className="feature-icon">📦</div>
                <div className="feature-label">Unit</div>
                <div className="feature-value">{product.unit}</div>
              </div>
            </div>

            {product.hasVariants && (
              <div style={{ marginBottom: '2rem' }}>
                <h4 style={{ fontSize: '0.9rem', color: 'var(--text-secondary)', marginBottom: '0.8rem', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Select Size</h4>
                <div style={{ display: 'flex', gap: '0.8rem', flexWrap: 'wrap' }}>
                  {Object.keys(product.variants).map(size => {
                    const variant = product.variants[size];
                    const isSelected = selectedSize === size;
                    const isVariantOutOfStock = variant.inStock === false;
                    return (
                      <button
                        key={size}
                        onClick={() => setSelectedSize(size)}
                        disabled={false}
                        style={{
                          padding: '0.8rem 1.5rem',
                          borderRadius: '12px',
                          border: isSelected ? '2px solid var(--primary)' : '1px solid var(--glass-border)',
                          background: isSelected ? 'rgba(254, 230, 0, 0.1)' : 'var(--surface-color)',
                          fontWeight: 'bold',
                          cursor: 'pointer',
                          opacity: isVariantOutOfStock ? 0.5 : 1,
                          position: 'relative',
                          minWidth: '60px'
                        }}
                      >
                        {size}
                        {isVariantOutOfStock && <span style={{ position: 'absolute', top: -8, right: -8, fontSize: '1rem' }}>🚫</span>}
                      </button>
                    );
                  })}
                </div>
              </div>
            )}

            <div style={{ fontSize: '1.05rem', lineHeight: '1.6', color: 'var(--text-secondary)', marginBottom: '2rem', whiteSpace: 'pre-line' }}>
              {product.description || 'No description available for this product.'}
            </div>

            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', paddingTop: '1.5rem', borderTop: '1px solid var(--glass-border)' }}>
              <div style={{ fontSize: '1.8rem', fontWeight: 800, color: 'var(--primary)' }}>
                Rs. {currentPrice}
              </div>

              {isOutOfStock ? (
                <div style={{ padding: '0.8rem 2rem', background: '#e0e0e0', color: '#888', borderRadius: '12px', fontWeight: 'bold', fontSize: '1.1rem', cursor: 'not-allowed' }}>SOLD OUT</div>
              ) : (
                quantity === 0 ? (
                  <button className="btn" style={{ fontSize: '0.9rem', padding: '0.6rem 1.5rem', whiteSpace: 'nowrap' }} onClick={handleAdd}>Add to Cart</button>
                ) : (
                  <div className="stepper" style={{ transform: 'scale(1)', transformOrigin: 'right' }}>
                    <button className="stepper-btn" onClick={handleRemove}>-</button>
                    <span className="stepper-value">{quantity} pc</span>
                    <button className="stepper-btn" onClick={handleAdd}>+</button>
                  </div>
                )
              )}
            </div>
          </div>
        </div>
      </div>
      <style jsx>{`
        @media (max-width: 768px) {
            .modal-grid { grid-template-columns: 1fr !important; }
            .modal-content-area { padding: 1.5rem !important; }
            .modal-image-area { min-height: 300px !important; }
            .product-title-modal { font-size: 1.6rem !important; }
        }
      `}</style>
    </div>
  );
}

function Home() {
  const [zone, setZone] = useState(null);
  const [cart, setCart] = useState([]);
  const [productData, setProductData] = useState(localProducts);
  const [loading, setLoading] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [activeCategory, setActiveCategory] = useState(null);
  const [deliveryFees, setDeliveryFees] = useState({
    supermarket: { A: 50, B: 150, C: 250 },
    hotel: { A: 50, B: 150, C: 250 },
    textile: { A: 50, B: 150, C: 250 }
  });
  const [phoneNumber, setPhoneNumber] = useState(localSettings.phoneNumber || '94771234567');
  const [shopType, setShopType] = useState('supermarket'); // 'supermarket' or 'hotel'
  const [showHeader, setShowHeader] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);
  const [banners, setBanners] = useState(localBanners);
  const [theme, setTheme] = useState('light');
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [toasts, setToasts] = useState([]);
  const [wishlist, setWishlist] = useState([]);

  useEffect(() => {
    const savedWishlist = localStorage.getItem('mr-local-wishlist');
    if (savedWishlist) setWishlist(JSON.parse(savedWishlist));
  }, []);

  const toggleWishlist = (productId) => {
    setWishlist(prev => {
      let newWishlist;
      if (prev.includes(productId)) {
        newWishlist = prev.filter(id => id !== productId);
        addToast('Removed from favorites', 'info');
      } else {
        newWishlist = [...prev, productId];
        addToast('Added to favorites! ❤️', 'success');
      }
      localStorage.setItem('mr-local-wishlist', JSON.stringify(newWishlist));
      return newWishlist;
    });
  };

  const addToast = (message, type = 'success') => {
    const id = Date.now();
    setToasts(prev => [...prev, { id, message, type }]);
    setTimeout(() => {
      setToasts(prev => prev.filter(t => t.id !== id));
    }, 3000);
  };

  const removeToast = (id) => setToasts(prev => prev.filter(t => t.id !== id));

  useEffect(() => {
    const savedZone = localStorage.getItem('mr-local-zone');
    if (savedZone) setZone(savedZone);
    const savedTheme = localStorage.getItem('app-theme') || 'light';
    setTheme(savedTheme);
  }, []);

  useEffect(() => {
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
      document.documentElement.classList.remove('light');
    } else {
      document.documentElement.classList.add('light');
      document.documentElement.classList.remove('dark');
    }
    localStorage.setItem('app-theme', theme);
  }, [theme]);

  useEffect(() => {
    document.documentElement.classList.remove('shop-supermarket', 'shop-hotel', 'shop-textile');
    document.documentElement.classList.add(`shop-${shopType}`);
  }, [shopType]);

  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        setShowHeader(false);
      } else {
        setShowHeader(true);
      }
      setLastScrollY(currentScrollY);

      // Scroll Spy Logic
      const sectionElements = categories
        .filter(cat => {
          const isHotelItem = ['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food'].includes(cat.id);
          const isTextileItem = ['mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(cat.id);
          if (shopType === 'hotel') return isHotelItem;
          if (shopType === 'textile') return isTextileItem;
          return !isHotelItem && !isTextileItem;
        })
        .map(cat => document.getElementById(`cat-${cat.id}`))
        .filter(el => el !== null);

      let currentSectionId = null;
      for (const section of sectionElements) {
        const rect = section.getBoundingClientRect();
        if (rect.top <= 250) {
          currentSectionId = section.id.replace('cat-', '');
        }
      }
      if (currentSectionId) setActiveCategory(currentSectionId);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, [lastScrollY, shopType]);

  const handleZoneSelect = (zoneId) => {
    setZone(zoneId);
    localStorage.setItem('mr-local-zone', zoneId);
  };

  const addToCart = (product) => {
    addToast(`${product.title} added! 🛒`);
    const inc = 1;
    setCart((prev) => {
      const existing = prev.find((item) => item.id === product.id);
      if (existing) {
        return prev.map((item) =>
          item.id === product.id ? { ...item, quantity: Number((item.quantity + inc).toFixed(3)) } : item
        );
      }
      return [...prev, { ...product, quantity: inc }];
    });
  };

  const removeFromCart = (product) => {
    const inc = 1;
    setCart((prev) => {
      const existing = prev.find((item) => item.id === product.id);
      if (existing && existing.quantity > inc) {
        return prev.map((item) =>
          item.id === product.id ? { ...item, quantity: Number((item.quantity - inc).toFixed(3)) } : item
        );
      }
      return prev.filter((item) => item.id !== product.id);
    });
  };

  const clearZone = () => {
    setZone(null);
    localStorage.removeItem('mr-local-zone');
  };

  // Filter Logic based on Shop Type and Search
  const filteredProducts = productData.filter(p => {
    const isHotelItem = ['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food'].includes(p.categoryId);
    const isTextileItem = ['mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(p.categoryId);

    let matchesShop = false;
    if (shopType === 'hotel') matchesShop = isHotelItem;
    else if (shopType === 'textile') matchesShop = isTextileItem;
    else matchesShop = !isHotelItem && !isTextileItem;

    const matchesSearch = p.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
      (p.titleTa && p.titleTa.includes(searchTerm));
    return matchesShop && matchesSearch;
  });

  // Suggestions Logic - only suggest from current shop type
  const suggestions = productData
    .filter(p => {
      const isHotelItem = ['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food'].includes(p.categoryId);
      const isTextileItem = ['mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(p.categoryId);

      let matchesShop = false;
      if (shopType === 'hotel') matchesShop = isHotelItem;
      else if (shopType === 'textile') matchesShop = isTextileItem;
      else matchesShop = !isHotelItem && !isTextileItem;

      return matchesShop && !filteredProducts.find(fp => fp.id === p.id);
    })
    .sort(() => 0.5 - Math.random())
    .slice(0, 4);

  return (
    <main className={`app-canvas shop-${shopType}`}>
      <header className={`app-header glass ${!showHeader ? 'header-hidden' : ''}`}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '0.8rem' }}>
            <button
              className="menu-toggle"
              onClick={() => setIsSidebarOpen(true)}
              aria-label="Open Menu"
            >
              <span></span>
              <span></span>
              <span></span>
            </button>
            <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
              <div style={{ width: '36px', height: '36px', background: 'var(--primary)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.2rem', boxShadow: '0 4px 12px rgba(254, 230, 0, 0.3)' }}>🛵</div>
              <h1 style={{ fontSize: 'clamp(1.1rem, 4vw, 1.4rem)', fontWeight: '800', letterSpacing: '-0.04em', color: 'var(--text-primary)' }}>Mr. Local</h1>
            </div>
          </div>

          <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
            {zone && (
              <button onClick={clearZone} style={{ fontSize: '0.9rem', color: 'var(--text-accent)', background: 'none', border: 'none', cursor: 'pointer', fontWeight: 600 }}>
                {DELIVERY_ZONES[zone]?.name.split('(')[0]} 📍
              </button>
            )}
            <button
              onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
              style={{
                background: 'var(--surface-color)',
                border: '1px solid var(--glass-border)',
                borderRadius: '50%',
                width: '36px',
                height: '36px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                cursor: 'pointer',
                fontSize: '1rem',
                boxShadow: '0 4px 12px rgba(0,0,0,0.05)',
                transition: 'all 0.3s ease'
              }}
              title={`Switch to ${theme === 'dark' ? 'Light' : 'Dark'} Mode`}
            >
              {theme === 'dark' ? '🔆' : '🌑'}
            </button>
          </div>
        </div>

        {/* Shop Type Toggle with Sliding Animation */}
        <div className={`toggle-container ${shopType === 'hotel' ? 'hotel-mode' : (shopType === 'textile' ? 'textile-mode' : '')}`}>
          <div className="toggle-slider"></div>
          <button
            onClick={() => { setShopType('supermarket'); setActiveCategory(null); }}
            className={`toggle-btn ${shopType === 'supermarket' ? 'active' : ''}`}
          >
            🥬 Mart
          </button>
          <button
            onClick={() => { setShopType('hotel'); setActiveCategory(null); }}
            className={`toggle-btn ${shopType === 'hotel' ? 'active' : ''}`}
          >
            🍽️ Eats
          </button>
          <button
            onClick={() => { setShopType('textile'); setActiveCategory(null); }}
            className={`toggle-btn ${shopType === 'textile' ? 'active' : ''}`}
          >
            👕 Style
          </button>
        </div>

        {/* Premium Search Bar */}
        <div style={{ position: 'relative' }}>
          <input
            type="text"
            placeholder="Search items... (e.g. Milk, Rice)"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            style={{
              width: '100%',
              padding: '1rem 1.5rem',
              borderRadius: '16px',
              border: '1px solid var(--glass-border)',
              background: 'var(--bg-color)',
              boxShadow: 'inset 0 2px 8px rgba(0,0,0,0.03)',
              fontSize: '1rem',
              fontWeight: 600,
              color: 'var(--text-primary)',
              transition: 'all 0.3s ease'
            }}
            className="search-input"
          />
          <div style={{ position: 'absolute', right: '1.2rem', top: '50%', transform: 'translateY(-50%)', opacity: 0.4 }}>🔍</div>
        </div>

        {/* Categories Strip inside Header */}
        <CategoryNav activeId={activeCategory} onSelect={setActiveCategory} shopType={shopType} />
      </header>

      <div className="container">
        {!zone && <LocationGate onSelect={handleZoneSelect} />}

        {loading ? (
          <div style={{ textAlign: 'center', padding: '4rem', color: 'var(--text-secondary)' }}>
            <div style={{ fontSize: '2rem', marginBottom: '1rem', animation: 'spin 1s linear infinite' }}>⌛</div>
            <p>Stocking shelves...</p>
          </div>
        ) : (
          <>
            <HeroSlider banners={banners} />
            <div className="main-layout">
              {/* Content Area */}
              <div className="content-area">

                <div style={{ paddingBottom: '2rem' }}>
                  {categories.filter(cat => {
                    if (shopType === 'hotel') return ['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food'].includes(cat.id);
                    if (shopType === 'textile') return ['mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(cat.id);
                    return !['breakfast', 'lunch', 'dinner', 'short-eats', 'fast-food', 'mens-wear', 'womens-wear', 'kids-wear', 'accessories'].includes(cat.id);
                  }).map((cat) => {
                    const products = filteredProducts.filter((p) => p.categoryId === cat.id);
                    if (products.length === 0) return null;

                    return (
                      <section id={`cat-${cat.id}`} key={cat.id} style={{ marginBottom: '2.5rem', scrollMarginTop: '220px' }}>
                        <h2 className="section-title">
                          {cat.name} <span style={{ fontSize: '0.9rem', color: 'var(--text-accent)', fontWeight: 'normal' }}>{cat.nameTa}</span>
                        </h2>
                        <ProductShelf
                          products={products}
                          cart={cart}
                          wishlist={wishlist}
                          toggleWishlist={toggleWishlist}
                          onAdd={addToCart}
                          onRemove={removeFromCart}
                          onSelect={setSelectedProduct}
                        />
                      </section>
                    );
                  })}

                  {filteredProducts.length === 0 && (
                    <div style={{ textAlign: 'center', padding: '4rem', color: 'var(--text-secondary)' }}>
                      <p>No items found matching "{searchTerm}"</p>
                    </div>
                  )}

                  {/* Suggestions Section */}
                  {searchTerm && suggestions.length > 0 && (
                    <div className="suggestion-header">
                      <h2 className="section-title">You might also need</h2>
                      <ProductShelf
                        products={suggestions}
                        cart={cart}
                        onAdd={addToCart}
                        onRemove={removeFromCart}
                        onSelect={setSelectedProduct}
                      />
                    </div>
                  )}
                </div>
              </div>

              <SidebarCart
                cart={cart}
                onAdd={addToCart}
                onRemove={removeFromCart}
                zoneId={zone}
                phoneNumber={phoneNumber}
                deliveryFees={deliveryFees}
                shopType={shopType}
              />
            </div>
          </>
        )}
      </div>

      {cart.length > 0 && (
        <StickyCart
          cart={cart}
          zoneId={zone}
          phoneNumber={phoneNumber}
          deliveryFees={deliveryFees}
          shopType={shopType}
        />
      )}

      {selectedProduct && (
        <ProductDetailsModal
          cart={cart}
          product={selectedProduct}
          onClose={() => setSelectedProduct(null)}
          onAdd={addToCart}
          onRemove={removeFromCart}
        />
      )}

      <ToastContainer toasts={toasts} removeToast={removeToast} />
      <SidebarMenu
        isOpen={isSidebarOpen}
        onClose={() => setIsSidebarOpen(false)}
        shopType={shopType}
        setShopType={setShopType}
      />
      <BottomNav activeShop={shopType} onShopSelect={setShopType} />
    </main>
  );
}

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Home />);
    </script>
</body>
</html>